# 项目结构总览

```
knowledge-base-bot/
│
├── 📄 README.md                    # 项目说明文档
├── 📄 requirements.txt             # Python 依赖列表
├── 📄 快速启动.md                   # 5分钟快速启动指南
├── 📄 .env.example                 # 环境变量模板
│
├── 📁 config/                      # 配置文件目录
│   └── config.yaml                 # 主配置文件（LLM、Prompt、字段映射等）
│
├── 📁 data/                        # 数据目录
│   ├── 📁 documents/               # 帮助文档存放区（用于构建知识库）
│   │   └── apifox/                 # Apifox 帮助文档
│   ├── 📁 templates/               # 模板文件
│   │   ├── bug_template.md        # 缺陷模板（按公司规范）
│   │   ├── feature_template.md    # 需求模板（按公司规范）
│   │   └── usage_template.md      # 使用问题模板
│   └── 📁 history/                 # 历史记录
│       ├── conversations/          # 对话历史
│       └── tickets/                # 工单记录
│
├── 📁 src/                         # 源代码目录
│   │
│   ├── 📁 bots/                    # 机器人模块
│   │   ├── main.py                # 主入口（FastAPI 服务）
│   │   ├── wecom_bot.py           # 企微机器人处理器
│   │   ├── feishu_bot.py          # 飞书机器人处理器
│   │   ├── conversation_manager.py # 对话管理器（信息收集流程）
│   │   └── feishu_integration.py  # 飞书 API 集成（工单创建）
│   │
│   ├── 📁 rag/                     # 知识库模块（RAG）
│   │   ├── knowledge_base.py      # 知识库管理器（向量检索）
│   │   ├── crawl_apifox_docs.py   # Apifox 文档爬虫
│   │   └── quick_start.py         # 快速启动脚本
│   │
│   ├── 📁 classifiers/             # 分类器模块
│   │   └── question_classifier.py # 问题分类器（Bug/需求/使用问题）
│   │
│   └── 📁 utils/                   # 工具模块
│       ├── config_loader.py       # 配置加载器
│       └── template_manager.py    # 模板管理器
│
├── 📁 logs/                        # 日志目录
│   └── bot.log                    # 机器人运行日志
│
└── 📁 docs/                        # 文档目录
    ├── 前置准备.md                 # 详细的准备指南
    ├── 实施计划.md                 # 分阶段实施计划
    └── 工作流程示例.md             # 完整的对话流程示例
```

## 核心文件说明

### 配置文件
- **config/config.yaml** - 所有配置的集中管理
  - LLM 配置（API Key、模型、参数）
  - 信息收集字段定义
  - 分类 Prompt 模板
  - 飞书字段映射
  - 风格和话术配置

### 模板文件（按你们公司的实际规范）
- **data/templates/bug_template.md**
  - 缺陷标题、出现环境、复现步骤
  - 预期/现状、是否必现、补充信息

- **data/templates/feature_template.md**
  - 用户使用情景、当前产品现状
  - 用户期望、用户属性、影响程度

### 核心模块

#### 1. 主入口
```python
# 启动 FastAPI 服务
# 监听飞书/企微 Webhook
# 路由到对应的处理器
python src/bots/main.py
```

#### 2. 对话管理
```python
# 管理信息收集流程
# 跟踪对话状态
# 处理用户输入
conversation_manager.py
```

#### 3. 知识库检索
```python
# 构建向量数据库
# RAG 检索相关文档
# 返回上下文信息
knowledge_base.py
```

#### 4. 问题分类
```python
# 基于 LLM 判断问题类型
# Bug / 需求 / 使用问题
# 提供判断理由和建议
question_classifier.py
```

#### 5. 飞书集成
```python
# 创建飞书工单
# 写入多维表格
# 发送通知消息
feishu_integration.py
```

## 数据流程

```
用户提问
   ↓
main.py (接收消息)
   ↓
conversation_manager.py (信息收集)
   ├→ 收集版本号
   ├→ 收集环境信息
   ├→ 收集复现步骤
   └→ 收集补充信息
   ↓
knowledge_base.py (知识检索)
   └→ 在文档中搜索相关内容
   ↓
question_classifier.py (问题分类)
   ├→ 判断类型 (Bug/需求/使用问题)
   ├→ 提供理由
   └→ 给出建议答案
   ↓
template_manager.py (模板生成)
   └→ 渲染对应模板
   ↓
feishu_integration.py (工单创建)
   └→ 发送到飞书多维表格
   ↓
人工审核 (最终确认)
   └→ 优先级、分配负责人
```

## 配置要点

### 1. 信息收集字段（按公司规范）

**缺陷记录 8 个字段**：
- 标题（20字以内）
- 版本号
- 环境（Web/客户端）
- 复现步骤（1-2-3-4）
- 预期结果
- 实际结果
- 是否必现
- 补充信息（截图、日志等）

**需求记录 9 个字段**：
- 标题
- 用户使用情景
- 当前产品现状
- 用户期望
- 用户类型
- 付费状态
- 团队规模
- 影响程度
- 反馈来源

### 2. 分类标准

**缺陷 (Bug)**：
产品功能与预期设计不符，或出现了错误/报错

**需求 (Feature)**：
产品缺少某个功能，或现有功能无法满足用户的工作流

**使用问题 (Usage)**：
用户未找到正确的操作方式或最佳实践

### 3. 质量保证

**缺陷记录规范**：
- ✅ 标题简明扼要（20字以内）
- ✅ 复现步骤清晰完整
- ✅ 预期/现状明确
- ✅ 环境信息完整
- ✅ 补充信息充分

**需求记录规范**：
- ✅ 使用情景具体
- ✅ 现状障碍清晰
- ✅ 用户期望明确
- ✅ 用户属性完整
- ✅ 影响程度量化

## 快速定位

### 想修改信息收集流程？
→ 编辑 `src/bots/conversation_manager.py` 和 `config/config.yaml`

### 想调整分类准确度？
→ 编辑 `config/config.yaml` 中的 `classifier.prompt_template`

### 想更换模板格式？
→ 编辑 `data/templates/` 下的模板文件

### 想添加新的文档源？
→ 编辑 `src/rag/knowledge_base.py`

### 想修改飞书字段映射？
→ 编辑 `config/config.yaml` 中的 `feishu_ticket.field_mappings`

### 想调整机器人回复话术？
→ 编辑 `src/bots/wecom_bot.py` 或 `feishu_bot.py`

## 技术栈

| 层级 | 技术选型 |
|------|---------|
| Web 框架 | FastAPI |
| LLM | Claude 3.5 / DeepSeek / GPT-4 |
| 向量数据库 | Chroma |
| RAG 框架 | LangChain |
| 文档爬虫 | BeautifulSoup + httpx |
| 模板引擎 | Jinja2 |
| 飞书 SDK | lark-oapi |
| 配置管理 | YAML + Pydantic |
| 日志 | Loguru |

## 文件统计

- **总文件数**: 20+
- **代码行数**: ~2000 行
- **配置文件**: 3 个
- **模板文件**: 3 个
- **文档**: 5 个

## 下一步

1. **立即开始**: 获取 LLM API Key
2. **本地测试**: 运行 `python src/bots/main.py`
3. **构建知识库**: 运行爬虫和向量数据库构建
4. **配置飞书**: 创建应用和多维表格
5. **小范围试用**: 在 1-2 个群测试
6. **收集反馈**: 优化 Prompt 和流程
7. **全面推广**: 部署到生产环境

祝使用愉快！🚀
